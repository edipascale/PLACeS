<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>PLACeS: src/Cache.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLACeS
   </div>
   <div id="projectbrief">Peer-to-peer Locality Aware Content dElivery Simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Cache.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * File:   Cache.hpp</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright: Emanuele Di Pascale (dipascae aT tcd dOt ie)</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Licensed under the Apache License v2.0 (see attached README.TXT file)</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Created on 30 April 2013, 11:23</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#ifndef CACHE_HPP</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CACHE_HPP</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;RunningAvg.hpp&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">enum</span> CachePolicy {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  LRU, </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  LFU  </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;};</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Timestamp, <span class="keyword">typename</span> Size&gt;</div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="structCacheEntry.html">   33</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structCacheEntry.html">CacheEntry</a> {</div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="structCacheEntry.html#a14d23447a21413443a12ac9ae35e9705">   34</a></span>&#160;  Timestamp <a class="code" href="structCacheEntry.html#a14d23447a21413443a12ac9ae35e9705">lastAccessed</a>; </div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="structCacheEntry.html#ae5f0b7e294fce7cc1b2942aa58c2ce14">   35</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structCacheEntry.html#ae5f0b7e294fce7cc1b2942aa58c2ce14">timesServed</a>; </div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="structCacheEntry.html#a52c91df378d0cd80ba758b8018c98aea">   36</a></span>&#160;  Size <a class="code" href="structCacheEntry.html#a52c91df378d0cd80ba758b8018c98aea">size</a>; </div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="structCacheEntry.html#ab47844cdfee2a579fc61aa21b1412870">   37</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structCacheEntry.html#ab47844cdfee2a579fc61aa21b1412870">uploads</a>; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;};</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt; </div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="classCache.html">   48</a></span>&#160;<span class="keyword">class </span><a class="code" href="classCache.html">Cache</a> {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keyword">typedef</span> std::map&lt;Content, CacheEntry&lt;Timestamp, Size&gt; &gt; CacheMap;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">protected</span>:</div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="classCache.html#afc09d0d3cd9201b7250425851ae177c8">   54</a></span>&#160;  CacheMap <a class="code" href="classCache.html#afc09d0d3cd9201b7250425851ae177c8">cacheMap</a>; </div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="classCache.html#aba9e1368b5896e4adb19164b387ddbcf">   55</a></span>&#160;  Size <a class="code" href="classCache.html#aba9e1368b5896e4adb19164b387ddbcf">maxSize</a>; </div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="classCache.html#ad714bf0b35953e2680083acab2074a5c">   56</a></span>&#160;  Size <a class="code" href="classCache.html#ad714bf0b35953e2680083acab2074a5c">currentSize</a>; </div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="classCache.html#a8279a53dddb2c8864b270300b243c0e7">   57</a></span>&#160;  CachePolicy <a class="code" href="classCache.html#a8279a53dddb2c8864b270300b243c0e7">policy</a>; </div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="classCache.html#aecbaf8b6511f4ee6945ef012423f5fc0">   58</a></span>&#160;  <a class="code" href="classRunningAvg.html">RunningAvg&lt;double, Timestamp&gt;</a> <a class="code" href="classCache.html#aecbaf8b6511f4ee6945ef012423f5fc0">cacheOccupancy</a>; </div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="classCache.html#a9b758cd6566c0a9baf7ec91de82789f5">   64</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classCache.html#a9b758cd6566c0a9baf7ec91de82789f5">updateOccupancy</a>(Timestamp time) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">double</span> occ = 100 * <a class="code" href="classCache.html#ad714bf0b35953e2680083acab2074a5c">currentSize</a> / <a class="code" href="classCache.html#aba9e1368b5896e4adb19164b387ddbcf">maxSize</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">bool</span> result = <a class="code" href="classCache.html#aecbaf8b6511f4ee6945ef012423f5fc0">cacheOccupancy</a>.<a class="code" href="classRunningAvg.html#ad74066a38bdbd2bb895d004e515e148b">add</a>(occ, time);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">if</span> (!result) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to update the cache occupancy at time &quot;</span> </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;              &lt;&lt; time &lt;&lt; <span class="stringliteral">&quot;, last timestamp: &quot;</span> &lt;&lt; <a class="code" href="classCache.html#aecbaf8b6511f4ee6945ef012423f5fc0">cacheOccupancy</a>.<a class="code" href="classRunningAvg.html#a2d1f5f590e1ce7c4069681101f22876f">getLastTimestamp</a>()</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;; aborting. &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      abort();</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="classCache.html#acbd4c6470f84811d28153fdc43af2d11">   76</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classCache.html#acbd4c6470f84811d28153fdc43af2d11">CacheTestClass</a>; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="classCache.html#af2492f2f0ec8a7567ec4d6ae89af6967">Cache</a>(Size <a class="code" href="classCache.html#aba9e1368b5896e4adb19164b387ddbcf">maxSize</a>, CachePolicy <a class="code" href="classCache.html#a8279a53dddb2c8864b270300b243c0e7">policy</a> = LRU);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  std::pair&lt;bool, std::set&lt;Content&gt; &gt; <a class="code" href="classCache.html#af6f1686fa186a801b57014311eceefd3">addToCache</a>(<span class="keyword">const</span> Content content, </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="keyword">const</span> Size size, <span class="keyword">const</span> Timestamp time);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classCache.html#a8e26cb683c269221c5ed3ff9739fe5c4">clearCache</a>();</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classCache.html#a1de974ba90e92a63e6ec57af0a201092">getFromCache</a>(<span class="keyword">const</span> Content&amp; content, <span class="keyword">const</span> Timestamp time, <span class="keyword">const</span> <span class="keywordtype">bool</span> local);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classCache.html#a7bf32e495d0217bc71821f4dbf5fe2ec">isCached</a>(<span class="keyword">const</span> Content&amp; content) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classCache.html#aa02ce16a7e7ee29ef06b8605e65a3b35">removeFromCache</a>(<span class="keyword">const</span> Content&amp; content, <span class="keyword">const</span> Timestamp time); <span class="comment">// for expired content</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classCache.html#a85df54ad592e1f74d27fe3e3c1515fbc">uploadCompleted</a>(<span class="keyword">const</span> Content&amp; content); <span class="comment">// to decrease the upload counter</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span>  <span class="keywordtype">int</span> <a class="code" href="classCache.html#a6b4c2cfec6263a89545e5a1029a56f79">getCurrentUploads</a>(<span class="keyword">const</span> Content&amp; content) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classCache.html#a4185136c7fbc8eadd9ea07cd9d7554b5">getTotalUploads</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="classCache.html#a8d448a2442dd7aa485813ea2c6eab598">  140</a></span>&#160;  <span class="keywordtype">double</span> <a class="code" href="classCache.html#a8d448a2442dd7aa485813ea2c6eab598">getAvgOccupancy</a>(<span class="keyword">const</span> Timestamp time)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordtype">double</span> avg = <a class="code" href="classCache.html#aecbaf8b6511f4ee6945ef012423f5fc0">cacheOccupancy</a>.<a class="code" href="classRunningAvg.html#a92708f2f26f3515e77737c25ee25047c">extract</a>(time);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">return</span> avg;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  }</div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="classCache.html#ae91a41ff83492511e23f7b3830d5b55e">  148</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classCache.html#ae91a41ff83492511e23f7b3830d5b55e">resetOccupancy</a>(<span class="keyword">const</span> Timestamp time) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordtype">double</span> value = 100 * <a class="code" href="classCache.html#ad714bf0b35953e2680083acab2074a5c">currentSize</a> / <a class="code" href="classCache.html#aba9e1368b5896e4adb19164b387ddbcf">maxSize</a>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="classCache.html#aecbaf8b6511f4ee6945ef012423f5fc0">cacheOccupancy</a>.<a class="code" href="classRunningAvg.html#a064a51be52f6b747107b59d06043d297">reset</a>(value, time);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  </div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="classCache.html#a1a510e11091c8c830c8241e72b480e81">  159</a></span>&#160;  CacheMap <a class="code" href="classCache.html#a1a510e11091c8c830c8241e72b480e81">getCacheMap</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classCache.html#afc09d0d3cd9201b7250425851ae177c8">cacheMap</a>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  </div>
<div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="classCache.html#a47413e47d0cb995ae45da8c32b13c853">  167</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classCache.html#a47413e47d0cb995ae45da8c32b13c853">getNumElementsCached</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classCache.html#afc09d0d3cd9201b7250425851ae177c8">cacheMap</a>.size();</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="classCache.html#abc7c5928febecb888d98888fc5687bbf">  175</a></span>&#160;  Size <a class="code" href="classCache.html#abc7c5928febecb888d98888fc5687bbf">getCurrentSize</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classCache.html#ad714bf0b35953e2680083acab2074a5c">currentSize</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="classCache.html#a41161daca14baff6f916c804d37c16dc">  183</a></span>&#160;  Size <a class="code" href="classCache.html#a41161daca14baff6f916c804d37c16dc">getMaxSize</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classCache.html#aba9e1368b5896e4adb19164b387ddbcf">maxSize</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  </div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="classCache.html#a906fd9a2ba0328a3313e6e1d23523ea7">  193</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classCache.html#a906fd9a2ba0328a3313e6e1d23523ea7">fitsInCache</a>(<span class="keyword">const</span> Size size)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCache.html#aba9e1368b5896e4adb19164b387ddbcf">maxSize</a> - <a class="code" href="classCache.html#ad714bf0b35953e2680083acab2074a5c">currentSize</a> &gt;= size)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;};</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt;</div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="line" href="classCache.html#af2492f2f0ec8a7567ec4d6ae89af6967">  203</a></span>&#160;<a class="code" href="classCache.html#af2492f2f0ec8a7567ec4d6ae89af6967">Cache&lt;Content, Size, Timestamp&gt;::Cache</a>(Size maxSize, CachePolicy policy) : cacheOccupancy() {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  this-&gt;maxSize = <a class="code" href="classCache.html#aba9e1368b5896e4adb19164b387ddbcf">maxSize</a>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  this-&gt;policy = <a class="code" href="classCache.html#a8279a53dddb2c8864b270300b243c0e7">policy</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  this-&gt;<a class="code" href="classCache.html#ad714bf0b35953e2680083acab2074a5c">currentSize</a> = 0;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt;</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="classCache.html#af6f1686fa186a801b57014311eceefd3">  210</a></span>&#160;std::pair&lt;bool, std::set&lt;Content&gt; &gt; <a class="code" href="classCache.html#af6f1686fa186a801b57014311eceefd3">Cache&lt;Content, Size, Timestamp&gt;::addToCache</a>(</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        Content content, Size size, Timestamp time) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  std::set&lt;Content&gt; deletedElements;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  deletedElements.clear();</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">// check if the content was already cached</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keyword">typename</span> CacheMap::iterator cIt = cacheMap.find(content);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">if</span> ((cIt != cacheMap.end() &amp;&amp; cIt-&gt;second.size &gt;= size) <span class="comment">// content already cached</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      || size &gt; getMaxSize()) { <span class="comment">// content cannot possibly fit in the cache</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// already cached or too big to be cached, quit </span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">return</span> std::make_pair(<span class="keyword">false</span>, deletedElements);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  }  </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> oldFreqStat = 0;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span> (cIt!= cacheMap.end()) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="comment">// the content was cached, but with a smaller chunk, delete it (but save</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="comment">// the caching info - after all it&#39;s the same content)</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      this-&gt;currentSize -= cIt-&gt;second.size;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      oldFreqStat = cIt-&gt;second.timesServed;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="comment">/* FIXME: if something goes wrong and we cannot cache the new element,</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">       * we will lose the previous (partial) copy</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">       */</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      this-&gt;cacheMap.erase(cIt);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">while</span> (currentSize + size &gt; maxSize) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="comment">// Replace content according to selected policy</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      Timestamp minTmp = std::numeric_limits&lt;Timestamp&gt;::max();</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="keyword">typename</span> CacheMap::iterator minIt = cacheMap.end();</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">switch</span> (policy) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">case</span> LRU:          </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">typename</span> CacheMap::iterator it = cacheMap.begin();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                  it != cacheMap.end(); it++) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="keywordflow">if</span> (it-&gt;second.uploads == 0 &amp;&amp; it-&gt;second.lastAccessed &lt; minTmp) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;              minTmp = it-&gt;second.lastAccessed;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;              minIt = it;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            }              </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">case</span> LFU:</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">typename</span> CacheMap::iterator it = cacheMap.begin();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                  it != cacheMap.end(); it++) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">if</span> (it-&gt;second.uploads == 0 &amp;&amp; it-&gt;second.timesServed &lt; minTmp) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;              minTmp = it-&gt;second.timesServed;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;              minIt = it;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            }              </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;          }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;          std::cerr &lt;&lt; <span class="stringliteral">&quot;ERROR: Cache::addToCache - unrecognized CachePolicy&quot;</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="comment">// check that there is an element we can erase (due to uploads)</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">if</span> (minIt == cacheMap.end()) {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="comment">// all elements are being used for uploads, cannot cache</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">return</span> std::make_pair(<span class="keyword">false</span>, deletedElements);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="comment">// else remove the identified element from the cache</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      currentSize -= minIt-&gt;second.size;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      deletedElements.insert(minIt-&gt;first);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      cacheMap.erase(minIt);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// insert new element in the cache</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <a class="code" href="structCacheEntry.html">CacheEntry&lt;Timestamp, Size&gt;</a> entry;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    entry.<a class="code" href="structCacheEntry.html#a14d23447a21413443a12ac9ae35e9705">lastAccessed</a> = time;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    entry.<a class="code" href="structCacheEntry.html#ae5f0b7e294fce7cc1b2942aa58c2ce14">timesServed</a> = oldFreqStat; <span class="comment">// 0 if the content is new</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    entry.<a class="code" href="structCacheEntry.html#a52c91df378d0cd80ba758b8018c98aea">size</a> = size;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    entry.<a class="code" href="structCacheEntry.html#ab47844cdfee2a579fc61aa21b1412870">uploads</a> = 0;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (cacheMap.insert(std::make_pair(content,entry)).second == <span class="keyword">true</span>) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      currentSize += size;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      assert(currentSize &lt;= maxSize);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      updateOccupancy(time);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">return</span> std::make_pair(<span class="keyword">true</span>, deletedElements);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;WARNING: Cache::addToCache() - Could not insert content &quot;</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;              &lt;&lt; std::endl;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      updateOccupancy(time);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">return</span> std::make_pair(<span class="keyword">false</span>, deletedElements);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;}</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt;</div>
<div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="classCache.html#a8e26cb683c269221c5ed3ff9739fe5c4">  291</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCache.html#a8e26cb683c269221c5ed3ff9739fe5c4">Cache&lt;Content, Size, Timestamp&gt;::clearCache</a>() {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  cacheMap.clear();</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  this-&gt;currentSize = 0;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  cacheOccupancy.reset(0,0);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;}</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt;</div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="classCache.html#a1de974ba90e92a63e6ec57af0a201092">  298</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCache.html#a1de974ba90e92a63e6ec57af0a201092">Cache&lt;Content, Size, Timestamp&gt;::getFromCache</a>(<span class="keyword">const</span> Content&amp; content, </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keyword">const</span> Timestamp time, <span class="keyword">const</span> <span class="keywordtype">bool</span> local) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keyword">typename</span> CacheMap::iterator it = cacheMap.find(content);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordflow">if</span> (it != cacheMap.end()) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    it-&gt;second.lastAccessed = time;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    it-&gt;second.timesServed++;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span> (!local)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      it-&gt;second.uploads++;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  } </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;}</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt;</div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="classCache.html#a7bf32e495d0217bc71821f4dbf5fe2ec">  313</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCache.html#a7bf32e495d0217bc71821f4dbf5fe2ec">Cache&lt;Content, Size, Timestamp&gt;::isCached</a>(<span class="keyword">const</span> Content&amp; content)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keyword">typename</span> CacheMap::const_iterator cIt = cacheMap.find(content);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordflow">if</span> (cIt != cacheMap.end())</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt;</div>
<div class="line"><a name="l00322"></a><span class="lineno"><a class="line" href="classCache.html#aa02ce16a7e7ee29ef06b8605e65a3b35">  322</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCache.html#aa02ce16a7e7ee29ef06b8605e65a3b35">Cache&lt;Content, Size, Timestamp&gt;::removeFromCache</a>(<span class="keyword">const</span> Content&amp; content, </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keyword">const</span> Timestamp time) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keyword">typename</span> CacheMap::const_iterator it = cacheMap.find(content);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">if</span> (it != cacheMap.end()) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    this-&gt;currentSize -= it-&gt;second.size;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    assert(this-&gt;currentSize &gt;= 0);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    cacheMap.erase(it);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    updateOccupancy(time);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;}</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt;</div>
<div class="line"><a name="l00334"></a><span class="lineno"><a class="line" href="classCache.html#a85df54ad592e1f74d27fe3e3c1515fbc">  334</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCache.html#a85df54ad592e1f74d27fe3e3c1515fbc">Cache&lt;Content, Size, Timestamp&gt;::uploadCompleted</a>(<span class="keyword">const</span> Content&amp; content) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keyword">typename</span> CacheMap::iterator it = cacheMap.find(content);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">if</span> (it != cacheMap.end()) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    it-&gt;second.uploads = it-&gt;second.uploads - 1;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    assert(it-&gt;second.uploads &gt;= 0);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt;</div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="classCache.html#a6b4c2cfec6263a89545e5a1029a56f79">  346</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classCache.html#a6b4c2cfec6263a89545e5a1029a56f79">Cache&lt;Content, Size, Timestamp&gt;::getCurrentUploads</a>(<span class="keyword">const</span> Content&amp; content)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keyword">typename</span> CacheMap::const_iterator it = cacheMap.find(content);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">if</span> (it != cacheMap.end()) {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">return</span> it-&gt;second.uploads;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Content, <span class="keyword">typename</span> Size, <span class="keyword">typename</span> Timestamp&gt;</div>
<div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="classCache.html#a4185136c7fbc8eadd9ea07cd9d7554b5">  356</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classCache.html#a4185136c7fbc8eadd9ea07cd9d7554b5">Cache&lt;Content, Size, Timestamp&gt;::getTotalUploads</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordtype">int</span> uploads = 0;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">typename</span> CacheMap::const_iterator it = cacheMap.begin(); it != cacheMap.end(); it++)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    uploads += it-&gt;second.uploads;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">return</span> uploads;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor">#endif  </span><span class="comment">/* CACHE_HPP */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor"></span></div>
<div class="ttc" id="structCacheEntry_html"><div class="ttname"><a href="structCacheEntry.html">CacheEntry</a></div><div class="ttdoc">Struct to hold the caching parameters associated to each content element; Timestamp must be a scalar ...</div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00033">Cache.hpp:33</a></div></div>
<div class="ttc" id="classRunningAvg_html"><div class="ttname"><a href="classRunningAvg.html">RunningAvg&lt; double, Timestamp &gt;</a></div></div>
<div class="ttc" id="classCache_html_ae91a41ff83492511e23f7b3830d5b55e"><div class="ttname"><a href="classCache.html#ae91a41ff83492511e23f7b3830d5b55e">Cache::resetOccupancy</a></div><div class="ttdeci">void resetOccupancy(const Timestamp time)</div><div class="ttdoc">Resets the time-weighted average occupancy of the Cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00148">Cache.hpp:148</a></div></div>
<div class="ttc" id="classCache_html_a85df54ad592e1f74d27fe3e3c1515fbc"><div class="ttname"><a href="classCache.html#a85df54ad592e1f74d27fe3e3c1515fbc">Cache::uploadCompleted</a></div><div class="ttdeci">bool uploadCompleted(const Content &amp;content)</div><div class="ttdoc">Notifies the Cache that the upload of a cached item has been completed, so that the related metadata ...</div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00334">Cache.hpp:334</a></div></div>
<div class="ttc" id="structCacheEntry_html_a52c91df378d0cd80ba758b8018c98aea"><div class="ttname"><a href="structCacheEntry.html#a52c91df378d0cd80ba758b8018c98aea">CacheEntry::size</a></div><div class="ttdeci">Size size</div><div class="ttdoc">Size of the item, i.e., the amount of storage it occupies. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00036">Cache.hpp:36</a></div></div>
<div class="ttc" id="classRunningAvg_html_a92708f2f26f3515e77737c25ee25047c"><div class="ttname"><a href="classRunningAvg.html#a92708f2f26f3515e77737c25ee25047c">RunningAvg::extract</a></div><div class="ttdeci">double extract(Timestamp currentTime) const </div><div class="ttdoc">Extracts the running average of our metric of interest at the specified currentTime. </div><div class="ttdef"><b>Definition:</b> <a href="RunningAvg_8hpp_source.html#l00092">RunningAvg.hpp:92</a></div></div>
<div class="ttc" id="classCache_html_a1de974ba90e92a63e6ec57af0a201092"><div class="ttname"><a href="classCache.html#a1de974ba90e92a63e6ec57af0a201092">Cache::getFromCache</a></div><div class="ttdeci">bool getFromCache(const Content &amp;content, const Timestamp time, const bool local)</div><div class="ttdoc">Updates the metadata related to a cached item after it has been accessed. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00298">Cache.hpp:298</a></div></div>
<div class="ttc" id="classCache_html_aba9e1368b5896e4adb19164b387ddbcf"><div class="ttname"><a href="classCache.html#aba9e1368b5896e4adb19164b387ddbcf">Cache::maxSize</a></div><div class="ttdeci">Size maxSize</div><div class="ttdoc">The maximum storage space available on this Cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00055">Cache.hpp:55</a></div></div>
<div class="ttc" id="classCache_html_aecbaf8b6511f4ee6945ef012423f5fc0"><div class="ttname"><a href="classCache.html#aecbaf8b6511f4ee6945ef012423f5fc0">Cache::cacheOccupancy</a></div><div class="ttdeci">RunningAvg&lt; double, Timestamp &gt; cacheOccupancy</div><div class="ttdoc">A tracker of the time-weighted average occupancy of the cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00058">Cache.hpp:58</a></div></div>
<div class="ttc" id="classCache_html_af6f1686fa186a801b57014311eceefd3"><div class="ttname"><a href="classCache.html#af6f1686fa186a801b57014311eceefd3">Cache::addToCache</a></div><div class="ttdeci">std::pair&lt; bool, std::set&lt; Content &gt; &gt; addToCache(const Content content, const Size size, const Timestamp time)</div><div class="ttdoc">Attempt to insert a new item in the Cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00210">Cache.hpp:210</a></div></div>
<div class="ttc" id="classRunningAvg_html_ad74066a38bdbd2bb895d004e515e148b"><div class="ttname"><a href="classRunningAvg.html#ad74066a38bdbd2bb895d004e515e148b">RunningAvg::add</a></div><div class="ttdeci">bool add(Value newValue, Timestamp time)</div><div class="ttdoc">Adds a new DataPoint to the measurement set and updates the average. </div><div class="ttdef"><b>Definition:</b> <a href="RunningAvg_8hpp_source.html#l00066">RunningAvg.hpp:66</a></div></div>
<div class="ttc" id="classCache_html_a906fd9a2ba0328a3313e6e1d23523ea7"><div class="ttname"><a href="classCache.html#a906fd9a2ba0328a3313e6e1d23523ea7">Cache::fitsInCache</a></div><div class="ttdeci">bool fitsInCache(const Size size) const </div><div class="ttdoc">Checks whether an item of Size size could currently fit in the Cache, without having to delete any of...</div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00193">Cache.hpp:193</a></div></div>
<div class="ttc" id="classCache_html_a6b4c2cfec6263a89545e5a1029a56f79"><div class="ttname"><a href="classCache.html#a6b4c2cfec6263a89545e5a1029a56f79">Cache::getCurrentUploads</a></div><div class="ttdeci">int getCurrentUploads(const Content &amp;content) const </div><div class="ttdoc">Retrieves the number of concurrent uploads of a specified item. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00346">Cache.hpp:346</a></div></div>
<div class="ttc" id="classCache_html_a4185136c7fbc8eadd9ea07cd9d7554b5"><div class="ttname"><a href="classCache.html#a4185136c7fbc8eadd9ea07cd9d7554b5">Cache::getTotalUploads</a></div><div class="ttdeci">int getTotalUploads() const </div><div class="ttdoc">Retrieves the total number of concurrent uploads for all the elements in the Cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00356">Cache.hpp:356</a></div></div>
<div class="ttc" id="classCache_html"><div class="ttname"><a href="classCache.html">Cache</a></div><div class="ttdoc">Implements a generic LRU or LFU cache, with a fixed maximum capacity maxSize and elements of type Con...</div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00048">Cache.hpp:48</a></div></div>
<div class="ttc" id="classCache_html_abc7c5928febecb888d98888fc5687bbf"><div class="ttname"><a href="classCache.html#abc7c5928febecb888d98888fc5687bbf">Cache::getCurrentSize</a></div><div class="ttdeci">Size getCurrentSize() const </div><div class="ttdoc">Retrieve the current storage occupation of the Cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00175">Cache.hpp:175</a></div></div>
<div class="ttc" id="structCacheEntry_html_ae5f0b7e294fce7cc1b2942aa58c2ce14"><div class="ttname"><a href="structCacheEntry.html#ae5f0b7e294fce7cc1b2942aa58c2ce14">CacheEntry::timesServed</a></div><div class="ttdeci">unsigned int timesServed</div><div class="ttdoc">Number of times this item was accessed. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00035">Cache.hpp:35</a></div></div>
<div class="ttc" id="classCache_html_a8279a53dddb2c8864b270300b243c0e7"><div class="ttname"><a href="classCache.html#a8279a53dddb2c8864b270300b243c0e7">Cache::policy</a></div><div class="ttdeci">CachePolicy policy</div><div class="ttdoc">The replacement policy used to make space for a new item when the Cache is full. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00057">Cache.hpp:57</a></div></div>
<div class="ttc" id="classCache_html_a47413e47d0cb995ae45da8c32b13c853"><div class="ttname"><a href="classCache.html#a47413e47d0cb995ae45da8c32b13c853">Cache::getNumElementsCached</a></div><div class="ttdeci">unsigned int getNumElementsCached() const </div><div class="ttdoc">Retrieves the number of items cached at the moment. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00167">Cache.hpp:167</a></div></div>
<div class="ttc" id="classCache_html_a7bf32e495d0217bc71821f4dbf5fe2ec"><div class="ttname"><a href="classCache.html#a7bf32e495d0217bc71821f4dbf5fe2ec">Cache::isCached</a></div><div class="ttdeci">bool isCached(const Content &amp;content) const </div><div class="ttdoc">Checks whether a given item is in the Cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00313">Cache.hpp:313</a></div></div>
<div class="ttc" id="classCache_html_a8d448a2442dd7aa485813ea2c6eab598"><div class="ttname"><a href="classCache.html#a8d448a2442dd7aa485813ea2c6eab598">Cache::getAvgOccupancy</a></div><div class="ttdeci">double getAvgOccupancy(const Timestamp time) const </div><div class="ttdoc">Retrieve the average cache occupancy as calculated at the specified Timestamp. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00140">Cache.hpp:140</a></div></div>
<div class="ttc" id="classCache_html_af2492f2f0ec8a7567ec4d6ae89af6967"><div class="ttname"><a href="classCache.html#af2492f2f0ec8a7567ec4d6ae89af6967">Cache::Cache</a></div><div class="ttdeci">Cache(Size maxSize, CachePolicy policy=LRU)</div><div class="ttdoc">Simple constructor. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00203">Cache.hpp:203</a></div></div>
<div class="ttc" id="classCache_html_acbd4c6470f84811d28153fdc43af2d11"><div class="ttname"><a href="classCache.html#acbd4c6470f84811d28153fdc43af2d11">Cache::CacheTestClass</a></div><div class="ttdeci">friend class CacheTestClass</div><div class="ttdoc">Class used for unit-testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00076">Cache.hpp:76</a></div></div>
<div class="ttc" id="classRunningAvg_html_a2d1f5f590e1ce7c4069681101f22876f"><div class="ttname"><a href="classRunningAvg.html#a2d1f5f590e1ce7c4069681101f22876f">RunningAvg::getLastTimestamp</a></div><div class="ttdeci">Timestamp getLastTimestamp() const </div><div class="ttdoc">Retrieves the timestamp of the last recorded measurement. </div><div class="ttdef"><b>Definition:</b> <a href="RunningAvg_8hpp_source.html#l00141">RunningAvg.hpp:141</a></div></div>
<div class="ttc" id="structCacheEntry_html_ab47844cdfee2a579fc61aa21b1412870"><div class="ttname"><a href="structCacheEntry.html#ab47844cdfee2a579fc61aa21b1412870">CacheEntry::uploads</a></div><div class="ttdeci">unsigned int uploads</div><div class="ttdoc">Number of current uploads of this item; used to calculate the bandwidth used and to ensure that we do...</div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00037">Cache.hpp:37</a></div></div>
<div class="ttc" id="classCache_html_a41161daca14baff6f916c804d37c16dc"><div class="ttname"><a href="classCache.html#a41161daca14baff6f916c804d37c16dc">Cache::getMaxSize</a></div><div class="ttdeci">Size getMaxSize() const </div><div class="ttdoc">Retrieve the maximum space available in the Cache, i.e., its capacity. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00183">Cache.hpp:183</a></div></div>
<div class="ttc" id="classCache_html_afc09d0d3cd9201b7250425851ae177c8"><div class="ttname"><a href="classCache.html#afc09d0d3cd9201b7250425851ae177c8">Cache::cacheMap</a></div><div class="ttdeci">CacheMap cacheMap</div><div class="ttdoc">The content of the cache, i.e., the set of items cached together with their caching metadata...</div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00054">Cache.hpp:54</a></div></div>
<div class="ttc" id="classCache_html_ad714bf0b35953e2680083acab2074a5c"><div class="ttname"><a href="classCache.html#ad714bf0b35953e2680083acab2074a5c">Cache::currentSize</a></div><div class="ttdeci">Size currentSize</div><div class="ttdoc">The current storage occupancy of this Cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00056">Cache.hpp:56</a></div></div>
<div class="ttc" id="classRunningAvg_html_a064a51be52f6b747107b59d06043d297"><div class="ttname"><a href="classRunningAvg.html#a064a51be52f6b747107b59d06043d297">RunningAvg::reset</a></div><div class="ttdeci">void reset(Value value, Timestamp time)</div><div class="ttdoc">Resets the RunningAvg to a new starting timestamp and starting value, like the constructor with the s...</div><div class="ttdef"><b>Definition:</b> <a href="RunningAvg_8hpp_source.html#l00131">RunningAvg.hpp:131</a></div></div>
<div class="ttc" id="classCache_html_a9b758cd6566c0a9baf7ec91de82789f5"><div class="ttname"><a href="classCache.html#a9b758cd6566c0a9baf7ec91de82789f5">Cache::updateOccupancy</a></div><div class="ttdeci">void updateOccupancy(Timestamp time)</div><div class="ttdoc">Updates the average Cache occupancy after a modification to the storage (i.e., an element was erased ...</div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00064">Cache.hpp:64</a></div></div>
<div class="ttc" id="classCache_html_a1a510e11091c8c830c8241e72b480e81"><div class="ttname"><a href="classCache.html#a1a510e11091c8c830c8241e72b480e81">Cache::getCacheMap</a></div><div class="ttdeci">CacheMap getCacheMap() const </div><div class="ttdoc">Get full access to the content of the Cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00159">Cache.hpp:159</a></div></div>
<div class="ttc" id="classCache_html_aa02ce16a7e7ee29ef06b8605e65a3b35"><div class="ttname"><a href="classCache.html#aa02ce16a7e7ee29ef06b8605e65a3b35">Cache::removeFromCache</a></div><div class="ttdeci">void removeFromCache(const Content &amp;content, const Timestamp time)</div><div class="ttdoc">Erases an item from the Cache, freeing up some storage space. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00322">Cache.hpp:322</a></div></div>
<div class="ttc" id="classCache_html_a8e26cb683c269221c5ed3ff9739fe5c4"><div class="ttname"><a href="classCache.html#a8e26cb683c269221c5ed3ff9739fe5c4">Cache::clearCache</a></div><div class="ttdeci">void clearCache()</div><div class="ttdoc">Delete all the items from the Cache. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00291">Cache.hpp:291</a></div></div>
<div class="ttc" id="structCacheEntry_html_a14d23447a21413443a12ac9ae35e9705"><div class="ttname"><a href="structCacheEntry.html#a14d23447a21413443a12ac9ae35e9705">CacheEntry::lastAccessed</a></div><div class="ttdeci">Timestamp lastAccessed</div><div class="ttdoc">Last time this item was accessed. </div><div class="ttdef"><b>Definition:</b> <a href="Cache_8hpp_source.html#l00034">Cache.hpp:34</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 16 2015 15:11:52 for PLACeS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
